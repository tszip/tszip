yarn run v1.22.5
$ yarn bootstrap && node dist/index.cjs build
$ yarn clean
$ rm -rf dist
$ tsc -p tsconfig.bootstrap.json && node dist/index.js build
âœ“ Cleaning dist/. 4 ms
â ™ TS âž¡ JS: Compiling with TSC  3%                  0.1s, estimated 2.8s
[2K[1A[2K[Gâ ¹ TS âž¡ JS: Compiling with TSC  6%                  0.2s, estimated 2.8s
[2K[1A[2K[Gâ ¸ TS âž¡ JS: Compiling with TSC  9%                  0.2s, estimated 2.8s
[2K[1A[2K[Gâ ¼ TS âž¡ JS: Compiling with TSC  11%                 0.3s, estimated 2.8s
[2K[1A[2K[Gâ ´ TS âž¡ JS: Compiling with TSC  14%                 0.4s, estimated 2.8s
[2K[1A[2K[Gâ ¦ TS âž¡ JS: Compiling with TSC  17%                 0.5s, estimated 2.8s
[2K[1A[2K[Gâ § TS âž¡ JS: Compiling with TSC  20%                 0.6s, estimated 2.8s
[2K[1A[2K[Gâ ‡ TS âž¡ JS: Compiling with TSC  23%                 0.6s, estimated 2.8s
[2K[1A[2K[Gâ  TS âž¡ JS: Compiling with TSC  26%                 0.7s, estimated 2.8s
[2K[1A[2K[Gâ ‹ TS âž¡ JS: Compiling with TSC  29%                 0.8s, estimated 2.8s
[2K[1A[2K[Gâ ™ TS âž¡ JS: Compiling with TSC  31%                 0.9s, estimated 2.8s
[2K[1A[2K[Gâ ¹ TS âž¡ JS: Compiling with TSC  34%                 1.0s, estimated 2.8s
[2K[1A[2K[Gâ ¸ TS âž¡ JS: Compiling with TSC  37%                 1.0s, estimated 2.8s
[2K[1A[2K[Gâ ¼ TS âž¡ JS: Compiling with TSC  40%                 1.1s, estimated 2.8s
[2K[1A[2K[Gâ ´ TS âž¡ JS: Compiling with TSC  43%                 1.2s, estimated 2.8s
[2K[1A[2K[Gâ ¦ TS âž¡ JS: Compiling with TSC  46%                 1.3s, estimated 2.8s
[2K[1A[2K[Gâ § TS âž¡ JS: Compiling with TSC  49%                 1.4s, estimated 2.8s
[2K[1A[2K[Gâ ‡ TS âž¡ JS: Compiling with TSC  51%                 1.4s, estimated 2.8s
[2K[1A[2K[Gâ  TS âž¡ JS: Compiling with TSC  54%                 1.5s, estimated 2.8s
[2K[1A[2K[Gâ ‹ TS âž¡ JS: Compiling with TSC  57%                 1.6s, estimated 2.8s
[2K[1A[2K[Gâ ™ TS âž¡ JS: Compiling with TSC  60%                 1.7s, estimated 2.8s
[2K[1A[2K[Gâ ¹ TS âž¡ JS: Compiling with TSC  63%                 1.8s, estimated 2.8s
[2K[1A[2K[Gâ ¸ TS âž¡ JS: Compiling with TSC  66%                 1.8s, estimated 2.8s
[2K[1A[2K[Gâ ¼ TS âž¡ JS: Compiling with TSC  69%                 1.9s, estimated 2.8s
[2K[1A[2K[Gâ ´ TS âž¡ JS: Compiling with TSC  71%                 2.0s, estimated 2.8s
[2K[1A[2K[Gâ ¦ TS âž¡ JS: Compiling with TSC  74%                 2.1s, estimated 2.8s
[2K[1A[2K[Gâ § TS âž¡ JS: Compiling with TSC  77%                 2.2s, estimated 2.8s
[2K[1A[2K[Gâ ‡ TS âž¡ JS: Compiling with TSC  80%                 2.2s, estimated 2.8s
[2K[1A[2K[Gâ  TS âž¡ JS: Compiling with TSC  83%                 2.3s, estimated 2.8s
[2K[1A[2K[Gâ ‹ TS âž¡ JS: Compiling with TSC  86%                 2.4s, estimated 2.8s
[2K[1A[2K[Gâ ™ TS âž¡ JS: Compiling with TSC  89%                 2.5s, estimated 2.8s
[2K[1A[2K[Gâ ¹ TS âž¡ JS: Compiling with TSC  91%                 2.6s, estimated 2.8s
[2K[1A[2K[Gâ ¸ TS âž¡ JS: Compiling with TSC  94%                 2.6s, estimated 2.8s
[2K[1A[2K[Gâ ¼ TS âž¡ JS: Compiling with TSC  97%                 2.7s, estimated 2.8s
[2K[1A[2K[Gâ ´ TS âž¡ JS: Compiling with TSC  99%                 2.8s, estimated 2.8s
[2K[1A[2K[Gâ ¦ TS âž¡ JS: Compiling with TSC  99%                 2.9s, estimated 2.8s
[2K[1A[2K[Gâ § TS âž¡ JS: Compiling with TSC  99%                 3.0s, estimated 2.8s
[2K[1A[2K[Gâ ‡ TS âž¡ JS: Compiling with TSC  99%                 3.0s, estimated 2.8s
[2K[1A[2K[Gâœ“ TS âž¡ JS: Compiling with TSC 3.1 secs
âœ“ Copying all non-TS and non-JS src/ files to dist/. 0 ms
âœ“ Creating CJS entry file 1 ms
âœ“ Creating MJS entry file 1 ms
Generated an empty chunk: "types"
â ™ TS âž¡ JS: Transpiling TS to JS  34%                 1.6s, estimated 4.6s
[2K[1A[2K[Gâ ¹ TS âž¡ JS: Transpiling TS to JS  45%                 2.1s, estimated 4.6s
[2K[1A[2K[Gâ ¸ TS âž¡ JS: Transpiling TS to JS  49%                 2.3s, estimated 4.6s
[2K[1A[2K[Gâ ¼ TS âž¡ JS: Transpiling TS to JS  54%                 2.5s, estimated 4.6s
Missing export "invertObject" has been shimmed in module dist/errors/invertObject.js.
Missing export "evalToString" has been shimmed in module dist/errors/evalToString.js.
Missing export "indentString" has been shimmed in module dist/utils/log.js.
Missing export "error" has been shimmed in module dist/output.js.
Missing export "default" has been shimmed in module dist/getInstallCmd.js.
Missing export "cmd" has been shimmed in module dist/output.js.
Missing export "default" has been shimmed in module dist/templates/basic.js.
Missing export "default" has been shimmed in module dist/templates/basic.js.
[2K[1A[2K[Gâ ´ TS âž¡ JS: Transpiling TS to JS  70%                 3.2s, estimated 4.6s
[2K[1A[2K[Gâ ¦ TS âž¡ JS: Transpiling TS to JS  73%                 3.4s, estimated 4.6s
Missing export "invertObject" has been shimmed in module dist/errors/invertObject.js.
Missing export "evalToString" has been shimmed in module dist/errors/evalToString.js.
Missing export "babelPluginExportTs" has been shimmed in module dist/babelPluginExportTs.js.
Missing export "evalToString" has been shimmed in module dist/errors/evalToString.js.
Missing export "paths" has been shimmed in module dist/constants.js.
Missing export "invertObject" has been shimmed in module dist/errors/invertObject.js.
Missing export "paths" has been shimmed in module dist/constants.js.
Missing export "default" has been shimmed in module dist/templates/basic.js.
[2K[1A[2K[Gâ § TS âž¡ JS: Transpiling TS to JS  86%                 4.0s, estimated 4.6s
Missing export "resolveApp" has been shimmed in module dist/utils.js.
Missing export "extractErrors" has been shimmed in module dist/errors/extractErrors.js.
Missing export "external" has been shimmed in module dist/utils.js.
Missing export "safeVariableName" has been shimmed in module dist/utils.js.
Missing export "babelPluginExportTs" has been shimmed in module dist/babelPluginExportTs.js.
Missing export "renameExtension" has been shimmed in module dist/utils/renameExtension.js.
Missing export "resolveApp" has been shimmed in module dist/utils.js.
Missing export "resolveApp" has been shimmed in module dist/utils.js.
Missing export "resolveApp" has been shimmed in module dist/utils.js.
Missing export "evalToString" has been shimmed in module dist/errors/evalToString.js.
Missing export "invertObject" has been shimmed in module dist/errors/invertObject.js.
[2K[1A[2K[Gâ ‡ TS âž¡ JS: Transpiling TS to JS  97%                 4.5s, estimated 4.6s
[2K[1A[2K[Gâ  TS âž¡ JS: Transpiling TS to JS  99%                 4.7s, estimated 4.6s
Missing export "indentString" has been shimmed in module dist/utils/log.js.
Missing export "error" has been shimmed in module dist/output.js.
Missing export "default" has been shimmed in module dist/getInstallCmd.js.
Missing export "cmd" has been shimmed in module dist/output.js.
Missing export "extractErrors" has been shimmed in module dist/errors/extractErrors.js.
Missing export "babelPluginExportTs" has been shimmed in module dist/babelPluginExportTs.js.
Missing export "renameExtension" has been shimmed in module dist/utils/renameExtension.js.
Missing export "default" has been shimmed in module dist/templates/basic.js.
Missing export "evalToString" has been shimmed in module dist/errors/evalToString.js.
Missing export "invertObject" has been shimmed in module dist/errors/invertObject.js.
Missing export "indentLog" has been shimmed in module dist/utils/log.js.
Missing export "composePackageJson" has been shimmed in module dist/templates/utils/index.js.
Missing export "default" has been shimmed in module dist/logError.js.
Missing export "default" has been shimmed in module dist/getInstallArgs.js.
Missing export "createJestConfig" has been shimmed in module dist/createJestConfig.js.
Missing export "indentString" has been shimmed in module dist/utils/log.js.
Missing export "error" has been shimmed in module dist/output.js.
Missing export "default" has been shimmed in module dist/getInstallCmd.js.
Missing export "cmd" has been shimmed in module dist/output.js.
Missing export "extractErrors" has been shimmed in module dist/errors/extractErrors.js.
Missing export "babelPluginExportTs" has been shimmed in module dist/babelPluginExportTs.js.
Missing export "renameExtension" has been shimmed in module dist/utils/renameExtension.js.
Missing export "default" has been shimmed in module dist/templates/basic.js.
Missing export "evalToString" has been shimmed in module dist/errors/evalToString.js.
Missing export "invertObject" has been shimmed in module dist/errors/invertObject.js.
Missing export "indentLog" has been shimmed in module dist/utils/log.js.
Missing export "composePackageJson" has been shimmed in module dist/templates/utils/index.js.
Missing export "default" has been shimmed in module dist/logError.js.
Missing export "default" has been shimmed in module dist/getInstallArgs.js.
Missing export "createJestConfig" has been shimmed in module dist/createJestConfig.js.
[2K[1A[2K[Gâ ‹ TS âž¡ JS: Transpiling TS to JS  99%                 5.2s, estimated 4.6s
[2K[1A[2K[Gâ ™ TS âž¡ JS: Transpiling TS to JS  99%                 5.3s, estimated 4.6s
[2K[1A[2K[Gâ ¹ TS âž¡ JS: Transpiling TS to JS  99%                 5.4s, estimated 4.6s
[2K[1A[2K[Gâ ¸ TS âž¡ JS: Transpiling TS to JS  99%                 5.4s, estimated 4.6s
[2K[1A[2K[Gâ ¼ TS âž¡ JS: Transpiling TS to JS  99%                 5.5s, estimated 4.6s
[2K[1A[2K[Gâ ´ TS âž¡ JS: Transpiling TS to JS  99%                 5.6s, estimated 4.6s
[2K[1A[2K[Gâ ¦ TS âž¡ JS: Transpiling TS to JS  99%                 5.7s, estimated 4.6s
[2K[1A[2K[Gâ § TS âž¡ JS: Transpiling TS to JS  99%                 5.8s, estimated 4.6s
[2K[1A[2K[Gâ ‡ TS âž¡ JS: Transpiling TS to JS  99%                 5.8s, estimated 4.6s
[2K[1A[2K[Gâ  TS âž¡ JS: Transpiling TS to JS  99%                 5.9s, estimated 4.6s
[2K[1A[2K[Gâ ‹ TS âž¡ JS: Transpiling TS to JS  99%                 6.0s, estimated 4.6s
[2K[1A[2K[Gâ ™ TS âž¡ JS: Transpiling TS to JS  99%                 6.1s, estimated 4.6s
[2K[1A[2K[Gâœ“ TS âž¡ JS: Transpiling TS to JS 6.1 secs
/home/christian/PersonalProjects/tszip/dist/index.cjs:1
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("sade/lib/index.js"),t=require("rollup"),r=require("chalk/source/index.js"),s=require("jest"),o=require("eslint/lib/api.js"),n=require("path"),i=require("execa/index.js"),a=require("shelljs/shell.js"),l=require("ora/index.js"),c=require("semver/index.js"),p=require("fs-extra/lib/index.js"),u=require("camelcase/index.js"),d=require("jpjs/dist/jpjs.js"),f=require("resolve.exports"),m=require("rollup-plugin-terser"),g=require("@babel/core/lib/index.js"),x=require("@rollup/plugin-commonjs/dist/index.js"),h=require("@rollup/plugin-json/dist/index.js"),y=require("typescript/lib/typescript.js"),w=require("@optimize-lodash/rollup-plugin/dist/index.js"),b=require("fs"),j=require("tiny-glob/index.js"),E=require("enquirer/lib/prompts/input.js"),v=require("enquirer/lib/prompts/select.js"),S=require("progress-estimator/src/index.js"),_=require("fs/promises");function k(e){return e&&"object"==typeof e&&"default"in e?e:{"default":e}}function O(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var s=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,s.get?s:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,t}require("@babel/helper-module-imports/lib/index.js");var C=k(e),$=k(r),q=k(s),F=k(n),D=k(i),J=k(a),z=k(l),P=k(c),M=k(p),I=O(p),R=k(u),N=k(f),T=k(x),A=k(h),L=k(y),B=k(j),W=k(E),U=k(v),V=k(S);const Y=e=>e.toLowerCase().replace(/(^@.*\/)|((^[^a-zA-Z]+)|[^\w.-])|([^a-zA-Z0-9]+$)/g,""),Z=M.default.realpathSync(process.cwd()),G=function(e){return F.default.resolve(Z,e)},H={appPackageJson:G("package.json"),tsconfigJson:G("tsconfig.json"),testsSetup:G("test/setupTests.ts"),appRoot:G("."),appSrc:G("src"),appErrorsJson:G("errors/codes.json"),appErrors:G("errors"),appDist:G("dist"),appConfig:G("tszip.config.js"),jestConfig:G("jest.config.js"),progressEstimatorCache:G("node_modules/.cache/.progress-estimator")};Object.defineProperty(exports,"__esModule",{value:!0});var Q=require("ansi-escapes/index.js"),X=require("chalk/source/index.js"),K=require("ora/index.js");function ee(e){return e&&"object"==typeof e&&"default"in e?e:{"default":e}}var te=ee(X),re=ee(K);exports.cmd=e=>te.default.bold(te.default.cyan(e)),exports.code=e=>`${te.default.gray("`")}${te.default.bold(e)}${te.default.gray("`")}`,exports.error=e=>{e instanceof Error&&(e=e.message),console.error(`${te.default.red("> Error!")} ${e}`)},exports.info=e=>{console.log(`${te.default.gray(">")} ${e}`)},exports.param=e=>te.default.bold(`${te.default.gray("{")}${te.default.bold(e)}${te.default.gray("}")}`),exports.success=e=>{console.log(`${te.default.green("> Success!")} ${e}`)},exports.wait=e=>{const t=re.default(te.default.green(e));return t.color="blue",t.start(),()=>{t.stop(),process.stdout.write(Q.eraseLine)}};const se=async function(e){const t=await _missingExportShim(),r={install:"npm"===t?"npm install":"yarn install",build:"npm"===t?"npm run build":"yarn build",start:"npm"===t?"npm run start":"yarn start",test:"npm"===t?"npm test":"yarn test"};return`\n  ${$.default.green("Awesome!")} You're now ready to start coding.\n  \n  I already ran ${_missingExportShim(r.install)} for you, so your next steps are:\n    ${_missingExportShim(`cd ${e}`)}\n  \n  To start developing (rebuilds on changes):\n    ${_missingExportShim(r.start)}\n  \n  To build for production:\n    ${_missingExportShim(r.build)}\n\n  To test your library with Jest:\n    ${_missingExportShim(r.test)}\n    \n  Questions? Feedback? Please let me know!\n  ${$.default.green("https://github.com/tszip/tszip/issues")}\n`};Object.defineProperty(exports,"__esModule",{value:!0});var oe=require("fs-extra/lib/index.js"),ne=require("@babel/parser/lib/index.js"),ie=require("@babel/traverse/lib/index.js"),ae=require("path"),le=require("camelcase/index.js"),ce=require("pascal-case/dist/index.js");function pe(e){return e&&"object"==typeof e&&"default"in e?e:{"default":e}}var ue=pe(oe),de=pe(ie),fe=pe(ae),me=pe(le);const ge=ue.default.realpathSync(process.cwd()),xe=function(e){return fe.default.resolve(ge,e)},he={appPackageJson:xe("package.json"),tsconfigJson:xe("tsconfig.json"),testsSetup:xe("test/setupTests.ts"),appRoot:xe("."),appSrc:xe("src"),appErrorsJson:xe("errors/codes.json"),appErrors:xe("errors"),appDist:xe("dist"),appConfig:xe("tszip.config.js"),jestConfig:xe("jest.config.js"),progressEstimatorCache:xe("node_modules/.cache/.progress-estimator")},ye={sourceType:"module",plugins:["classProperties","flow","jsx","trailingFunctionCommas","objectRestSpread"]};exports.extractErrors=async function(e){if(!e||!e.errorMapFilePath)throw new Error("Missing options. Ensure you pass an object with `errorMapFilePath`.");if(!e.name||!e.name)throw new Error("Missing options. Ensure you pass --name flag to tszip");const t=e.errorMapFilePath;let r;try{const e=await ue.default.readFile(t,"utf-8");r=JSON.parse(e)}catch(e){r={}}const s=Object.keys(r);let o;return o=0===s.length?0:Math.max.apply(null,s)+1,r=_missingExportShim(r),async function(s){(function(e){const t=ne.parse(e,ye);de.default(t,{CallExpression:{exit(e){var t;e.get("callee").isIdentifier({name:"invariant"})&&(t=_missingExportShim(e.node.arguments[1]),r.hasOwnProperty(t)||(r[t]=""+o++))}}})})(s),await async function(){const s=ce.pascalCase(me.default((o=e.name,o.replace(/^@.*\//,"")).toLowerCase().replace(/((^[^a-zA-Z]+)|[^\w.-])|([^a-zA-Z0-9]+$)/g,"")));var o;await ue.default.ensureDir(he.appErrors),await ue.default.writeFile(t,JSON.stringify(_missingExportShim(r),null,2)+"\n","utf-8"),await ue.default.writeFile(he.appErrors+"/ErrorDev.js","\nfunction ErrorDev(message) {\n  const error = new Error(message);\n  error.name = 'Invariant Violation';\n  return error;\n}\n\nexport default ErrorDev;\n      ","utf-8"),await ue.default.writeFile(he.appErrors+"/ErrorProd.js",`\nfunction ErrorProd(code) {\n  // TODO: replace this URL with yours\n  let url = 'https://reactjs.org/docs/error-decoder.html?invariant=' + code;\n  for (let i = 1; i < arguments.length; i++) {\n    url += '&args[]=' + encodeURIComponent(arguments[i]);\n  }\n  return new Error(\n    \`Minified ${s} error #\${code}; visit \${url} for the full message or \` +\n      'use the non-minified dev environment for full errors and additional ' +\n      'helpful warnings. '\n  );\n}\n\nexport default ErrorProd;\n`,"utf-8")}()}},Object.defineProperty(exports,"__esModule",{value:!0});var we=require("@babel/core/lib/index.js"),be=require("@rollup/plugin-babel/dist/index.js"),je=function(e){return e&&"object"==typeof e&&"default"in e?e:{"default":e}}(require("lodash.merge"));const Ee=e=>!!e&&(e.constructor!==Object||Object.keys(e).length>0),ve=[{original:"lodash(?!/fp)",replacement:"lodash-es"}],Se=(e,...t)=>{const r=[];return t.forEach((t=>{t.forEach((t=>{const s=r.findIndex((e=>e.file.resolved===t.file.resolved));-1!==s?r[s]=we.createConfigItem([r[s].file.resolved,je.default(r[s].options,t.options)],{type:e}):r.push(t)}))})),r},_e=(e,t)=>t.map((({name:t,...r})=>we.createConfigItem([require.resolve(t),r],{type:e}))),ke=be.createBabelInputPluginFactory((()=>({options:({custom:e,...t})=>({customOptions:e,pluginOptions:t}),config(e,{customOptions:t}){const r=_e("plugin",[{name:"babel-plugin-macros"},{name:"babel-plugin-annotate-pure-calls"},{name:"babel-plugin-dev-expression"},"cjs"!==t.format&&{name:"babel-plugin-transform-rename-import",replacements:ve},{name:"babel-plugin-polyfill-regenerator",method:"usage-pure"},{name:"@babel/plugin-proposal-class-properties",loose:!0},Ee(t.extractErrors)&&{name:"./errors/transformErrorMessages"}].filter(Boolean)),s=e.options||{};s.presets=s.presets||[];const o=s.presets.findIndex((e=>e.file.request.includes("@babel/preset-env")));if(-1!==o){const e=s.presets[o];s.presets[o]=we.createConfigItem([e.file.resolved,je.default({loose:!0,targets:t.targets},e.options,{modules:!1})],{type:"preset"})}else{const e=_e("preset",[{name:"@babel/preset-env",targets:t.targets,modules:!1,loose:!0}]);s.presets=Se("preset",e,s.presets)}return s.plugins=Se("plugin",r,s.plugins||[]),s}})));function Oe(e){const t=e.split("node_modules"),r=t[0];if(t.length<2)return null;const s=t[1].split(n.sep),o=s[1].startsWith("@")?s.slice(1,3).join(n.sep):s[1];return n.resolve(r,"node_modules",o,"package.json")}exports.babelPluginExportTs=ke,exports.createConfigItems=_e,exports.isTruthy=Ee,exports.mergeConfigItems=Se;const Ce=["react","react-native"],$e={errorMapFilePath:H.appErrorsJson};Object.defineProperty(exports,"__esModule",{value:!0});var qe=require("path");exports.renameExtension=(e,t)=>{const r=qe.extname(e);return e.replace(new RegExp(`\\${r}$`),t)};let Fe={rollup:(e,t)=>e};async function De(e){const t=(await B.default("./dist/**/*",{filesOnly:!0})).filter((e=>/^\.(js|jsx)/.test(n.extname(e)))),r=d.concatAllArray(t.map((t=>function(e,t){return t===n.resolve("dist","index.js")?[{...e,input:t,output:_missingExportShim(t,".cjs"),format:"cjs",env:"production"},{...e,input:t,output:_missingExportShim(t,".mjs"),format:"esm",env:"production"}]:[{...e,input:t,output:t,format:"cjs",env:"production"}]}(e,n.resolve(t)).map(((e,t)=>({...e,writeMeta:0===t}))))));return await Promise.all(r.map((async e=>{const t=await async function(e){const t=await _missingExportShim({...$e,...e}),r=e.format.includes("es")||e.format.includes("esm"),s=void 0!==e.minify?e.minify:"production"===e.env||r,o=L.default.readConfigFile(e.tsconfig||H.tsconfigJson,L.default.sys.readFile).config,i=L.default.parseJsonConfigFileContent(o,L.default.sys,"./").options,a="production"===process.env.NODE_ENV,l=["esm"===e.format?".mjs":null,"cjs"===e.format?".cjs":null,".js"].filter(Boolean);return{input:e.input,external:e=>!e.startsWith("regenerator-runtime")&&(!!Ce.includes(e)||(e=>!e.startsWith(".")&&!F.default.isAbsolute(e))(e)),shimMissingExports:!0,treeshake:{propertyReadSideEffects:!1},output:{file:e.output,format:r?"es":e.format,freeze:!1,esModule:Boolean(i?.esModuleInterop)||r,name:e.name||(c=e.name,R.default((e=>e.replace(/^@.*\//,""))(c).toLowerCase().replace(/((^[^a-zA-Z]+)|[^\w.-])|([^a-zA-Z0-9]+$)/g,""))),sourcemap:!0,globals:{react:"React","react-native":"ReactNative","lodash-es":"lodashEs","lodash/fp":"lodashFp"},exports:"named"},plugins:[e.extractErrors&&{name:"Extract errors",async transform(e){try{await t(e)}catch(e){return null}return{code:e,map:null}}},T.default({extensions:[".js",".cjs",".mjs"],esmExternals:!0,requireReturnsDefault:!0,transformMixedEsModules:!0,include:"umd"===e.format||r?/\/node_modules\//:/\/regenerator-runtime\//}),A.default(),{name:"Remove shebang",transform:e=>({code:e=e.replace(/^#!(.*)/,""),map:null})},e.legacy&&_missingExportShim({exclude:"node_modules/**",extensions:[...g.DEFAULT_EXTENSIONS,"ts","tsx"],passPerPreset:!0,custom:{targets:{..."node"===e.target?{node:14}:{},esmodules:r},extractErrors:e.extractErrors,format:e.format},babelHelpers:"bundled"}),e.env&&{name:"Replace process.NODE_ENV",renderChunk:async(e,t)=>({code:e.replace(/process\.env\.NODE_ENV(?!\s*=)/g,JSON.stringify(a?"production":"development")),map:null})},s&&m.terser({format:{keep_quoted_props:!0,comments:!1},compress:{keep_infinity:!0,pure_getters:!0,passes:10},ecma:e.legacy?5:2020,module:r,toplevel:"cjs"===e.format||r}),w.optimizeLodashImports({useLodashEs:r||void 0}),!e.legacy&&w.optimizeLodashImports({useLodashEs:r||void 0}),{name:"Resolve final runtime imports to files",renderChunk:async(t,r)=>{for(const s of r.imports){if(n.extname(s))continue;let r=require.resolve(s);const o=n.extname(r),i=r.replace(o,"");if("esm"===e.format||"cjs"===e.format)for(const e of l){const t=i+e;if(b.existsSync(t)){r=t;break}}const a=Oe(r);if(!a||!b.existsSync(a))continue;const c=b.readFileSync(a,"utf-8"),p=JSON.parse(c);if(N.default.resolve(p,s))continue;const u=r.slice(r.indexOf(s)),d=new RegExp(`(from|require\\()\\s*['"]${s.replace(".","\\.")}['"]`,"g"),f=t.match(d)??[];for(const e of f){const r=e.replace(s,u);t=t.replace(e,r)}}return{code:t,map:null}}},{name:"Ensure default exports",renderChunk:async(e,t)=>t.exports.includes("default")||!r?null:{code:`${e}\nexport default {};`,map:null}}]};var c}(e);return Fe.rollup(t,e)})))}async function Je(){return await M.default.ensureDir(H.progressEstimatorCache),V.default({storagePath:H.progressEstimatorCache})}b.existsSync(H.appConfig)&&(Fe=require(H.appConfig)),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default={name:"basic",dependencies:["husky","tszip","tslib","typescript","size-limit","@size-limit/preset-small-lib"],packageJson:{version:"0.1.0",license:"MIT",main:"./dist/index.cjs",module:"./dist/index.mjs",exports:{"./package.json":"./package.json",".":{import:"./dist/index.mjs",require:"./dist/index.cjs"}},typings:"dist/index.d.ts",files:["dist","src"],engines:{node:">=14"},scripts:{start:"tszip watch",build:"tszip build",test:"tszip test",posttest:"node test/import.mjs && node test/require.cjs",lint:"tszip lint",prepare:"tszip build",size:"size-limit",analyze:"size-limit --why"},peerDependencies:{},husky:{hooks:{"pre-commit":"tszip lint"}},prettier:{printWidth:80,semi:!0,singleQuote:!0,trailingComma:"es5"}}};const ze={name:"react",dependencies:[..._missingExportShim.dependencies,"@types/react","@types/react-dom","react","react-dom"],packageJson:{..._missingExportShim.packageJson,peerDependencies:{react:">=16"},scripts:{..._missingExportShim.packageJson.scripts,test:"tszip test"}}},Pe={dependencies:[...ze.dependencies,"@babel/core","@storybook/addon-essentials","@storybook/addon-links","@storybook/addon-info","@storybook/addons","@storybook/react","react-is","babel-loader"],name:"react-with-storybook",packageJson:{...ze.packageJson,scripts:{...ze.packageJson.scripts,storybook:"start-storybook -p 6006","build-storybook":"build-storybook"}}},Me={basic:_missingExportShim,react:ze,"react-with-storybook":Pe};Object.defineProperty(exports,"__esModule",{value:!0}),exports.invertObject=function(e){const t={},r=Object.keys(e);for(const s of r)t[e[s]]=s;return t},Object.defineProperty(exports,"__esModule",{value:!0}),exports.evalToString=function e(t){switch(t.type){case"StringLiteral":case"Literal":return t.value;case"BinaryExpression":if("+"!==t.operator)throw new Error("Unsupported binary operator "+t.operator);return e(t.left)+e(t.right);default:throw new Error("Unsupported type "+t.type)}};const Ie=C.default("tszip");let Re;try{Re=JSON.parse(b.readFileSync(H.appPackageJson,"utf-8"))}catch(qe){}const Ne=e=>_.stat(e).then((e=>e.isDirectory())).catch((()=>!1)),Te=e=>_.stat(e).then((e=>e.isFile())).catch((()=>!1));async function Ae(e,t){let r=[];if(e)Array.isArray(e)?r.push(...e):r.push(e);else if(t){const e=G(t);r.push(e)}else if(await Ne(G("src"))){const e=await async function(e){const t=await Te(G("src/index.ts"))?".ts":await Te(G("src/index.tsx"))?".tsx":await Te(G("src/index.jsx"))?".jsx":".js";return G(`src/index${t}`)}();r.push(e)}const s=r.map((async e=>await B.default(e,{filesOnly:!0})));return(await Promise.all(s)).flat()}async function Le(e){return{...e,name:e.name||Re.name,input:await Ae(e.entry,Re.source),format:e.format.split(",").map((e=>"es"===e?"esm":e))}}async function Be(){await M.default.remove(H.appDist)}function We(e){const t=`#!/usr/bin/env node\n\n'use strict';\nmodule.exports = require('./${Y(e)}.production.min.cjs');\n`;return M.default.outputFile(F.default.join(H.appDist,"index.cjs"),t)}function Ue(e){const t=`#!/usr/bin/env node\n\nexport { default } from './${e}.min.mjs';\nexport * from './${e}.min.mjs';\n`;return M.default.outputFile(F.default.join(H.appDist,"index.mjs"),t)}function Ve(e){J.default.exec(`npm config set init-author-name "${e}"`,{silent:!0})}Ie.command("create <pkg>").describe("Create a new package with ").example("create mypackage").option("--template",`Specify a template. Allowed choices: [${Object.keys(Me).join(", ")}]`).example("create --template react mypackage").action((async(e,t)=>{console.log(),_missingExportShim($.default.bgBlue("tszip"),2),console.log();const r=z.default(`Creating ${$.default.bold.green(e)}...`);let s;try{const n=await M.default.realpath(process.cwd());let i=await async function t(s){if(!await M.default.pathExists(s))return s;r.fail(`Failed to create ${$.default.bold.red(e)}`);const o=new W.default({message:`A folder named ${$.default.bold.red(e)} already exists! ${$.default.bold("Choose a different name")}`,initial:e+"-1",result:e=>e.trim()});return e=await o.run(),s=await M.default.realpath(process.cwd())+"/"+e,r.start(`Creating ${$.default.bold.green(e)}...`),await t(s)}(n+"/"+e);const a=new U.default({message:"Choose a template",choices:Object.keys(Me)});t.template?(s=t.template.trim(),a.choices.includes(s)||(r.fail(`Invalid template ${$.default.bold.red(s)}`),s=await a.run())):s=await a.run(),r.start(),await M.default.copy(F.default.resolve(__dirname,`../templates/${s}`),i,{overwrite:!0}),await M.default.move(F.default.resolve(i,"./gitignore"),F.default.resolve(i,"./.gitignore"));let l=await M.default.readFile(F.default.resolve(i,"LICENSE"),{encoding:"utf-8"});l=l.replace(/<year>/,`${(new Date).getFullYear()}`);let c=function(){let e="";return e=J.default.exec("npm config get init-author-name",{silent:!0}).stdout.trim(),e||(e=J.default.exec("git config --global user.name",{silent:!0}).stdout.trim(),e?(Ve(e),e):(e=J.default.exec("npm config get init-author-email",{silent:!0}).stdout.trim(),e||(e=J.default.exec("git config --global user.email",{silent:!0}).stdout.trim(),e||e)))}();if(!c){r.stop();const e=new W.default({name:"author",message:"Who is the package author?"});c=await e.run(),Ve(c),r.start()}l=l.replace(/<author>/,c.trim()),await M.default.writeFile(F.default.resolve(i,"LICENSE"),l,{encoding:"utf-8"});const p=_missingExportShim(Me[s]);process.chdir(i);const u=p({name:Y(e),author:c}),d=function({engines:e}){return e&&e.node}(u);d&&!P.default.satisfies(process.version,d)&&(r.fail((o=d,`Unsupported Node version! Your current Node version (${$.default.red(process.version)}) does not satisfy the requirement of Node ${$.default.cyan(o)}.`)),process.exit(1)),await M.default.outputJSON(F.default.resolve(i,"package.json"),u),r.succeed(`Created ${$.default.bold.green(e)}`),await se(e)}catch(t){r.fail(`Failed to create ${$.default.bold.red(e)}`),_missingExportShim(t),process.exit(1)}var o;const n=Me[s],{dependencies:i}=n,a=z.default((l=i.sort(),`Installing dependencies:\n\n${l.map((e=>_missingExportShim(`${$.default.cyan($.default.bold(e))}`,2))).join("\n")}\n\n`)).start();var l;try{const t=await _missingExportShim();await D.default(t,_missingExportShim(t,i)),a.succeed("Installed dependencies"),_missingExportShim("Initializing git repo."),await D.default("git",["init"]),console.log(await se(e))}catch(e){a.fail("Failed to install dependencies"),_missingExportShim(e),process.exit(1)}})),Ie.command("watch").describe("Rebuilds on any change").option("--entry, -i","Entry module").example("watch --entry src/foo.tsx").option("--target","Specify your target environment","browser").example("watch --target node").option("--name","Specify name exposed in UMD builds").example("watch --name Foo").option("--format","Specify module format(s)","cjs,esm").example("watch --format cjs,esm").option("--verbose","Keep outdated console output in watch mode instead of clearing the screen").example("watch --verbose").option("--noClean","Don't clean the dist folder").example("watch --noClean").option("--tsconfig","Specify custom tsconfig path").example("watch --tsconfig ./tsconfig.foo.json").option("--onFirstSuccess","Run a command on the first successful build").example('watch --onFirstSuccess "echo The first successful build!"').option("--onSuccess","Run a command on a successful build").example('watch --onSuccess "echo Successful build!"').option("--onFailure","Run a command on a failed build").example('watch --onFailure "The build failed!"').option("--transpileOnly","Skip type checking").example("watch --transpileOnly").option("--extractErrors","Extract invariant errors to ./errors/codes.json.").example("watch --extractErrors").action((async e=>{const r=await Le(e),s=await De(r);r.noClean||await Be(),r.format.includes("cjs")&&await We(r.name),r.format.includes("esm")&&await Ue(r.name);let o=!0,n=null,i=null;function a(e){if(!e)return null;const[t,...r]=e.split(" ");return D.default(t,r,{stdio:"inherit"})}const l=z.default().start();t.watch(s.map((e=>({watch:{silent:!0,include:["src/**"],exclude:["node_modules/**"]},...e})))).on("event",(async e=>{if(await Promise.all([n?n.kill("SIGTERM"):null,i?i.kill("SIGTERM"):null]),"START"===e.code&&(r.verbose||process.stdout.write("win32"===process.platform?"[2J[0f":"[2J[3J[H"),l.start($.default.bold.cyan("Compiling modules..."))),"ERROR"===e.code&&(l.fail($.default.bold.red("Failed to compile")),_missingExportShim(e.error),i=a(r.onFailure)),"END"===e.code){l.succeed($.default.bold.green("Compiled successfully")),console.log(`\n  ${$.default.dim("Watching for changes")}\n`);try{await async function(){const e=H.appDist+"/src";await I.pathExists(e)&&(console.warn('[tszip]: Your rootDir is currently set to "./". Please change your rootDir to "./src".\ntszip has deprecated setting tsconfig.compilerOptions.rootDir to "./" as it caused buggy output for declarationMaps and more.\nYou may also need to change your include to remove "test", which also caused declarations to be unnecessarily created for test files.'),await I.copy(e,H.appDist,{overwrite:!0}),await I.remove(e))}(),o&&r.onFirstSuccess?(o=!1,a(r.onFirstSuccess)):n=a(r.onSuccess)}catch(e){}}}))})),Ie.command("build").describe("Build your project once and exit").option("--entry, -i","Entry module").example("build --entry src/foo.tsx").option("--target","Specify your target environment","browser").example("build --target node").option("--name","Specify name exposed in UMD builds").example("build --name Foo").option("--format","Specify module format(s)","cjs,esm").example("build --format cjs,esm").option("--legacy","Babel transpile and emit ES5.").example("build --legacy").option("--tsconfig","Specify custom tsconfig path").example("build --tsconfig ./tsconfig.foo.json").option("--transpileOnly","Skip type checking").example("build --transpileOnly").option("--extractErrors","Extract errors to ./errors/codes.json and provide a url for decoding.").example("build --extractErrors=https://reactjs.org/docs/error-decoder.html?invariant=").action((async e=>{const r=await Le(e),s=await De(r),o=await Je(),i=r.name.includes("@")?r.name.slice(r.name.indexOf("/")+1):r.name;await o(Be(),"Cleaning dist/."),await async function({tsconfig:e=null,transpileOnly:t=!1,watch:r=!1}={}){const s=(e=>{const t=[];for(const[e,r]of Object.entries({rootDir:"src/",outDir:"dist/",jsx:"react-jsx",module:"esnext",target:"esnext",noEmit:!1,allowJs:!0,declaration:!0,sourceMap:!0,esModuleInterop:!0,resolveJsonModule:!0}))t.push(`--${e}`,r.toString());return t})();e&&s.push("-p",e);const o=await Je();await o((async()=>{try{await D.default("tsc",s)}catch(e){t||(console.error(e.toString()),process.exit(1))}})(),"TS âž¡ JS: Compiling with TSC");const i=await B.default("src/**/*",{filesOnly:!0});await o(Promise.all(i.filter((e=>!/^\.(ts|cjs|mjs|tsx|js|jsx|json)$/.test(n.extname(e)))).map((async e=>await p.copy(e,n.join("dist",n.basename(e)))))),"Copying all non-TS and non-JS src/ files to dist/."),r&&await D.default("tsc",[...s,"--watch","--preserveWatchOutput"])}({tsconfig:r.tsconfig,transpileOnly:r.transpileOnly}),r.format.includes("cjs")&&await o(We(i).catch(_missingExportShim),"Creating CJS entry file"),r.format.includes("esm")&&await o(Ue(i).catch(_missingExportShim),"Creating MJS entry file");try{await o(Promise.all(s.map((async e=>{const r=await t.rollup(e);await r.write(e.output)}))),"TS âž¡ JS: Transpiling TS to JS")}catch(e){_missingExportShim(e),process.exit(1)}})),Ie.command("test").describe("Run jest test runner. Passes through all flags directly to Jest").action((async e=>{process.env.BABEL_ENV="test",process.env.NODE_ENV="test",process.on("unhandledRejection",(e=>{throw e}));const t=process.argv.slice(2);let r={..._missingExportShim((e=>F.default.resolve(__dirname,"..",e)),e.config?F.default.dirname(e.config):H.appRoot),...Re.jest};const s=await M.default.pathExists(H.jestConfig);if(e.config||s){const t=G(e.config||H.jestConfig),s=require(t);r={...r,...s}}if(e.config){let e=t.indexOf("--config");if(-1!==e)t.splice(e,2);else{const r=/--config=.+/;e=t.findIndex((e=>e.match(r))),-1!==e&&t.splice(e,1)}}t.push("--config",JSON.stringify({...r}));const[,...o]=t;q.default.run(o)})),Ie.command("lint").describe("Run eslint with Prettier").example("lint src test").option("--fix","Fixes fixable errors and warnings").example("lint src test --fix").option("--ignore-pattern","Ignore a pattern").example("lint src test --ignore-pattern test/foobar.ts").option("--max-warnings","Exits with non-zero error code if number of warnings exceed this number",Infinity).example("lint src test --max-warnings 10").option("--write-file","Write the config file locally").example("lint --write-file").option("--report-file","Write JSON report to file locally").example("lint --report-file eslint-report.json").action((async e=>{if(0===e._.length&&!e["write-file"]){const t=["src","test"].filter(M.default.existsSync);e._=t,console.log($.default.yellow(`Defaulting to "tszip lint ${t.join(" ")}"`,'\nYou can override this in the package.json scripts, like "lint": "tszip lint src otherDir"'))}const t=await async function({pkg:e,rootDir:t,writeFile:r}){const s={extends:["react-app","prettier/@typescript-eslint","plugin:prettier/recommended"],settings:{react:{version:Boolean(function({dependencies:e,devDependencies:t}){return e&&e.react||t&&t.react}(e))?"detect":"999.999.999"}}};if(!r)return s;const o=F.default.join(t,".eslintrc.js");try{await M.default.writeFile(o,`module.exports = ${JSON.stringify(s,null,2)}`,{flag:"wx"})}catch(e){return"EEXIST"===e.code?console.error("Error trying to save the Eslint configuration file:",`${o} already exists.`):console.error(e),s}}({pkg:Re,rootDir:H.appRoot,writeFile:e["write-file"]}),r=new o.CLIEngine({baseConfig:{...t,...Re.eslint},extensions:[".ts",".tsx",".js",".jsx"],fix:e.fix,ignorePattern:e["ignore-pattern"]}),s=r.executeOnFiles(e._);e.fix&&o.CLIEngine.outputFixes(s),console.log(r.getFormatter()(s.results)),e["report-file"]&&await M.default.outputFile(e["report-file"],r.getFormatter("json")(s.results)),s.errorCount&&process.exit(1),s.warningCount>e["max-warnings"]&&process.exit(1)})),Ie.parse(process.argv),exports.isDir=Ne,exports.isFile=Te;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            

ReferenceError: _missingExportShim is not defined
    at Object.<anonymous> (/home/christian/PersonalProjects/tszip/dist/index.cjs:1:13187)
    at Module._compile (internal/modules/cjs/loader.js:1063:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1092:10)
    at Module.load (internal/modules/cjs/loader.js:928:32)
    at Function.Module._load (internal/modules/cjs/loader.js:769:14)
    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:72:12)
    at internal/main/run_main_module.js:17:47
error Command failed with exit code 1.
info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.
